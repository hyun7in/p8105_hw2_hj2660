---
title: "p8105_hw2_hj2660"
author: "Hyun Jin Jung"
date: "2023-10-04"
output: github_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include = FALSE}
library(tidyverse)
library(dplyr)
```

## Problem 1

Clean the data in pols-month.csv. There are months when Ford became president following Nixon, during which the 'prez_gop' variable is 2. We can reassign these cases to be coded as 'gop,' which is consistent with months when 'prez_gop' is 1. This ensures that the 'president' variable maintains consistency in labeling the political affiliation, regardless of the transition between Nixon and Ford.

```{r}
pols_df = 
  read.csv("fivethirtyeight_datasets/pols-month.csv") |>
  separate(mon, into = c("year", "month", "day"), sep = "-") |>
  mutate(month = month.abb[as.integer(month)]) |>
  mutate(president = recode(prez_gop, "0" =  "dem", "1" = "gop", "2" = "gop")) |>
  mutate(year = as.integer(year)) |>
  select(-prez_gop, -prez_dem, -day)
```

Clean the data in snp.csv, and to ensure the year is in four digits, we can use 'if_else'.

```{r}
snp_df = 
  read.csv("fivethirtyeight_datasets/snp.csv") |>
  separate(date, into = c("month", "day", "year"), convert = TRUE) |>
  select(year, month, everything()) |>
  mutate(month = month.abb[as.integer(month)]) |>
  mutate(year = if_else(year >= 50, 1900 + year, 2000 + year)) |>
  mutate(year = as.integer(year)) |>
  select(year, month, close)
```

Tidy data in unemployment.csv and change from 'wide' to 'long' format so that it can be merged with the other two datasets.

```{r}
unemployment_df = 
  read.csv("fivethirtyeight_datasets/unemployment.csv") |>
  rename(year = Year) |>
  pivot_longer(
    Jan:Dec,
    names_to = "month",
    values_to = "unemployment"
  ) |>
  select(year, month, unemployment)
```

Join the datasets by merging pols_df, snap_df, and unemployment_df

```{r}
data = 
  left_join(pols_df, snp_df, by = c("year", "month")) |>
  left_join(unemployment_df, by = c("year", "month"))

str(data)
```

```{r, echo=FALSE, results='hide'}
average_unemployment_dem = data |>
  filter(month == "Jan", year >= 1975, president == "dem") |>
  pull(unemployment) |>
  mean() |>
  round(2)
```

```{r, echo=FALSE, results='hide'}
average_unemployment_gop = data |>
  filter(month == "Jan", year >= 1975, president == "gop") |>
  pull(unemployment) |>
  mean() |>
  round(2)
```

The `pols_df` has `r nrow(pols_df)` observations and `r ncol(pols_df)` variables and tells about the party affiliation distribution of national politicians from 1947 to 2015. The `snp_df` has `r nrow(snp_df)` observations and `r ncol(snp_df)` variables, ranging from years 1950 to 2015. The `unemployment_df` has `r nrow(unemployment_df)` observations and `r ncol(unemployment_df)` variables, covering the years from 1948 to 2015. The average unemployment rate for January, starting in the year 1975, during months when the president is a Democrat, is `r average_unemployment_dem`%. The average unemployment rate for Republicans over the same time period was `r average_unemployment_gop`%. Missing values in the 'close' and 'unemployment' variables have been replaced with 'NA' values.


## Problem 2


Clean and organize the dataset for Mr. Trash Wheel.
```{r}
MrTrashWheel_df = 
  readxl::read_excel("./Trash_Wheel/202309 Trash Wheel Collection Data.xlsx", sheet = "Mr. Trash Wheel", range = "A2:N586") |>
  janitor::clean_names() |>
  mutate(homes_powered = (weight_tons * 500)/30) |>
  mutate(trash_wheel = "Mr. Trash Wheel") |>
  mutate(year = as.character(year)) 
```


Clean and organize the dataset for Professor Trash Wheel.
```{r}
ProfTrashWheel_df =
  readxl::read_excel("./Trash_Wheel/202309 Trash Wheel Collection Data.xlsx", sheet = "Professor Trash Wheel", range = "A2:M108") |>
  janitor::clean_names() |>
  mutate(homes_powered = (weight_tons * 500)/30) |>
  mutate(trash_wheel = "Professor Trash Wheel") |>
  mutate(year = as.character(year))
```

Clean and organize the dataset for Gwynnda Trash Wheel.
```{r}
GwynTrashWheel_df =
  readxl::read_excel("./Trash_Wheel/202309 Trash Wheel Collection Data.xlsx", sheet = "Gwynnda Trash Wheel", range = "A2:K157") |>
  janitor::clean_names() |>
  mutate(homes_powered = (weight_tons * 500)/30) |>
  mutate(trash_wheel = "Gwynnda Trash Wheel") |>
  mutate(year = as.character(year))
```

While combining three datasets, an error occurred, indicating that there was a data type mismatch between the 'year' columns, with one being of type 'character' and the other of type 'double.' To resolve this issue, the 'year' column in each dataset was uniformly converted to the 'character' data type. Additionally, a 'trash_wheel' column was introduced in each dataset to specify the corresponding Trash Wheel.
```{r}
combined_df = 
  bind_rows(MrTrashWheel_df, ProfTrashWheel_df, GwynTrashWheel_df)
```


```{r, echo=FALSE, results='hide'}
total_weight_profTW =
  ProfTrashWheel_df |>
  pull(weight_tons) |>
  sum()
```

```{r, echo=FALSE, results='hide'}
total_cig_Gwyn_july21 =
  GwynTrashWheel_df |>
  filter(format(date, "%Y-%m") == "2021-07") |>
  pull(cigarette_butts) |>
  sum() |>
  as.integer()
```

The `MrTrashWheel_df` has `r nrow(MrTrashWheel_df)` observations and `r ncol(MrTrashWheel_df)` variables. The `ProfTrashWheel_df` has `r nrow(ProfTrashWheel_df)` observations and `r ncol(ProfTrashWheel_df)` variables. The `GwynTrashWheel_df` has `r nrow(GwynTrashWheel_df)` observations and `r ncol(GwynTrashWheel_df)` variables. The total weight of trash collected by Professor Trash Wheel is `r total_weight_profTW`. The total number of cigarette butts collected by Gwynnda in July of 2021 is `r total_cig_Gwyn_july21`.

and give examples of key variables. 

